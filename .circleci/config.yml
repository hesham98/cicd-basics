version: 2.1

jobs:
  configure_infrastructure: 
    docker:
      - image: amazon/aws-cli
    steps:
      - checkout
      
      - run:
          name: Create Cloudformation Stack
          command: |
            pwd
            ls
            aws cloudformation deploy \
              --template-file ec2.yml \
              --stack-name web \
              --region us-east-1

      - run:
          name: make inventory file
          command: |
            yum intall -y tar gzip
            echo "[web]" > inventory.txt 
            echo "hello" >> inventory.txt
      
      - persist_to_workspace:
          root: ~/
          paths: 
            - inventory.txt  

workflows:
  # Name the workflow "welcome"
  welcome:
    # Run the welcome/run job in its own container
    jobs:
      - configure_infrastructure
